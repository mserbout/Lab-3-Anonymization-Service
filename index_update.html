<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="static/style1.css">
    <title>Anonymization Service</title>
</head>

<body>

    <h1>Anonymization Service</h1>

    <hr> <!-- Horizontal Rule for Separation -->

    <!-- Import Database Section -->
    <h1>Import Database</h1>
    <form id="import-database-form" enctype="multipart/form-data">
        <label for="file">Choose a file:</label><br>
        <input type="file" id="file" name="file" accept=".csv, .xls, .xlsx, .jdbc"><br>
        <button type="button" onclick="importDatabase()">Upload</button>
    </form>

    <hr> <!-- Horizontal Rule for Separation -->

    <h1>Generate Dataset</h1>
    <form id="generate-dataset-form">
        <label for="num-rows">Number of Rows:</label><br>
        <input type="number" id="num-rows" name="num_rows" min="1" required><br>
        <button type="button" onclick="generateDataset()">Generate Dataset</button>
    </form>

    <hr> <!-- Horizontal Rule for Separation -->

    <!-- Show Results Section -->
    <h1>Show Results</h1>
    <div id="results-container" class="results-container"></div>
    <button type="button" onclick="showResults()">Show Results</button>


    <hr> <!-- Horizontal Rule for Se    paration -->

    <h1>Anonymize Data</h1>
    <form id="anonymizeForm">
        <label for="attributes">Attributes to drop (comma-separated):</label><br>
        <input type="text" id="attributes" name="attributes"><br><br>
        <button type="button" onclick="submitForm()">Anonymize Data</button>
    </form>

    <p id="result"></p>

    <script>
        function submitForm() {
            var attributesInput = document.getElementById("attributes");
            var attributes = attributesInput.value.split(',').map(function(item) {
                return item.trim();
            });
            var data = { "attributes_to_drop": attributes };

            fetch("/anonymize", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                var resultElement = document.getElementById("result");
                resultElement.innerText = data.message;
            })
            .catch(error => console.error('Error:', error));
        }
    </script>


    <hr> <!-- Horizontal Rule for Separation -->


    <!-- K-Anonymize Data Section -->
    <h1>K-Anonymize Data</h1>
    <form id="kanonymize-form" action="/k_anonymize" method="POST">
        <label for="k">K value:</label>
        <input type="number" id="k" name="k" min="1" required><br>
        <label for="columns">Columns (comma-separated):</label>
        <input type="text" id="columns" name="columns" required><br>
        <button type="button" onclick="kanonymizeData()">K-Anonymize Data</button>
    </form>

    <hr> <!-- Horizontal Rule for Separation -->

    <!-- L-Diversity Form Section -->
   <h1>L-Diversity Form</h1>
   <form id="l_diversify_form">
       <label for="l">Minimum Unique Values (l):</label><br>
       <input type="number" id="l" name="l" required><br><br>
       <label for="sensitive_column">Sensitive Column:</label><br>
       <input type="text" id="sensitive_column" name="sensitive_column" required><br><br>
       <label for="quasi_identifier_columns">Quasi-Identifier Columns (comma-separated):</label><br>
       <input type="text" id="quasi_identifier_columns" name="quasi_identifier_columns" required><br><br>
       <button type="button" onclick="applyLDiversity()">Apply L-Diversity</button>
   </form>
   <div id="result"></div>

    <script> 

        function kanonymizeData() {
            var k = document.getElementById("k").value;
            var columns = document.getElementById("columns").value.split(',').map(item => item.trim());
            var formData = {
                "k": parseInt(k),
                "columns": columns
            };
            var jsonData = JSON.stringify(formData);

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/k_anonymize", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    console.log(xhr.responseText);
                    alert(xhr.responseText);
                }
            };
            xhr.send(jsonData);
        }

        function importDatabase() {
            var form = document.getElementById("import-database-form");
            var formData = new FormData(form);

            fetch('/importing_database', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(result => {
                // Display the result
                alert(result);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function showResults() {
            fetch('/show_results')
            .then(response => response.text())
            .then(result => {
                var table = document.createElement("table");
                table.innerHTML = result;
                var resultsContainer = document.getElementById("results-container");
                resultsContainer.innerHTML = ""; // Clear previous results
                resultsContainer.appendChild(table);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
        
        // Add event listeners to enable/disable form sections after generating dataset
        document.getElementById("generate-dataset-form").addEventListener('submit', function(event) {
            toggleFormSections(false); // Disable form sections before generating dataset
        });
        
        document.getElementById("generate-dataset-form").addEventListener('reset', function(event) {
            toggleFormSections(true); // Enable form sections if dataset generation form is reset
        });
        
        

        function toggleFormSections(enable) {
            var forms = document.querySelectorAll('form');
            forms.forEach(function(form) {
                var elements = form.elements;
                for (var i = 0; i < elements.length; i++) {
                    elements[i].disabled = !enable;
                }
            });
        }
        
        function generateDataset() {
            var numRows = document.getElementById("num-rows").value;
            var formData = {
                "num_rows": parseInt(numRows)
            };
            var jsonData = JSON.stringify(formData);
        
            fetch('/generate_dataset', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: jsonData
            })
            .then(response => response.text())
            .then(result => {
                alert(result);
                toggleFormSections(true); // Enable other form sections after generating dataset
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function applyLDiversity() {
            var l = document.getElementById("l").value;
            var sensitiveColumn = document.getElementById("sensitive_column").value;
            var quasiIdentifierColumns = document.getElementById("quasi_identifier_columns").value.split(',').map(item => item.trim());
            var formData = {
                "l": parseInt(l),
                "sensitive_column": sensitiveColumn,
                "quasi_identifier_columns": quasiIdentifierColumns
            };
            var jsonData = JSON.stringify(formData);
            fetch("/l_diversify", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: jsonData
            })
            .then(response => response.text())
            .then(data => {
                document.getElementById("result").innerHTML = data;
            })
            .catch(error => console.error("Error:", error));
        }
    </script>
</body>


</html>